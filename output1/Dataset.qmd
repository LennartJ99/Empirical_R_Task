---
title: "Dataset"
format: html
editor: visual
author: "Lennart Joop and Julia Daetz"
bibliography: references.bib
echo: false
warning: false
---

The following document is a description of the data that was used for our research project as described in milestone 2. We will provide an overview of the data we used, present sources and discuss data quality. Additionally, there we provide a scatter plot and a histogram for the main outcome variable (change of the number of EU migrants per voting district) and the endogenous variable (AfD vote share per voting district).

## Endogenous Variable: AfD Vote Shares

We used election data from the national German elections in the years 2017 and 2021. The data is from the "Bundeswahlleiterin" (Federal Returning Officer), which is responsible for the overview and organisation of the federal elections for the Bundestag. The "Bundeswahlleiterin" is directly appointed by the Federal Ministry of the Interior (<https://www.bundeswahlleiterin.de/en/ueber-uns/aufgaben.html>). Due to it coming from an official source, we assume the data to be accurate. The unit of measurement are the AfD election results of the second vote in percentage points for each voting district.

*Link: <https://www.bundeswahlleiterin.de/dam/jcr/860495c9-83fb-4068-8a99-c1c985ffffd2/w-btw21_kerg2.csv>*

This is the election data of 2021. "Prozent" is the election result from 2021, "VorpProzent" is the election data from the previous election in 2017.

*Citation: the Federal Returning Officer, Tabelle: Ergebnisse nach Wahlkreisen (flacher Aufbau). <https://www.bundeswahlleiterin.de/dam/jcr/860495c9-83fb-4068-8a99-c1c985ffffd2/w-btw21_kerg2.csv>*

```{r,include=FALSE}
#|label: Summary_Election_2017
#|output: false
#|code-line-numbers: false

library(here)
library(sf)

source(here("R/load","load_spatial.R"))
source(here("R/load","Health_Data.R"))
source(here("R/load","load_Unemployment+Income.R"))
source(here("R/load","Population.R"))
source(here("R/load","Load_bundestagwahl.R"))
source(here("R/load","load_migrationData.R"))
source(here("R/wrangle","Combined_Data.R"))
```

```{r}
cat("Summary AFD Results 2017")
summary(Combined_Data$Election2017)
"The numbers of NA is"
sum(is.na(Combined_Data$Election2017))

```

```{r}
#|label: Summary_Election_2021
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary AFD Results 2021")
summary(Combined_Data$Election2021)
"The numbers of NA is"
sum(is.na(Combined_Data$Election2021))

```

## Main outcome variable: Change of the number of EU migrants

The data regarding the number of EU Migrants is from DESTATIS, the official German Statistical Office, and in particular from the GENESIS-Database. Again, DESTATIS is the Office, which is responsible for official German data regarding economics, society, environment and the state. Therefore, the data can be assumed to be extremely trustworthy (https://www.destatis.de/EN/About-Us/\_node.html). We used migration data from 2016 and 2020 as a baseline for the elections in the years 2017 and 2021. We then observed the change of migration after the elections by comparing the baseline in 2016 to the years 2017 and 2018 and the baseline of 2020 to the years 2021 and 2022. Due to the election being in september, but the cutoffs for the migration data being the end of the year, we look at the change of migrants 3 months after the election (2017 compared to 2016 and 2021 compared to 2020) and 15 months after the election (2018 compared to 2016 and 2022 compared to 2020). The unit of measurement is the percentage change of the EU migrants 3 months and 15 months after the election. Due to the migration data only being accessible for federal units, which differ from voting districts, we combine the endogenous variable and the outcome variable by spatial matching. This will be explained in the \[Spatial Data\] part.

*Link: <https://www-genesis.destatis.de/genesis//online?operation=table&code=12521-0040&bypass=true&levelindex=1&levelid=1719084022304#abreadcrumb>*

To acces the data that was used, it is necessary to create a free account and select the years 2016, 2017, 2018, 2020, 2021 and 2022.

*Citation: DESTATIS. 12521-0040:Ausländer: Kreise, Stichtag, Geschlecht. <https://www-genesis.destatis.de/genesis//online?operation=table&code=12521-0040&bypass=true&levelindex=1&levelid=1719084022304#abreadcrumb>*

```{r, include=FALSE}
#|output: false
#|code-line-numbers: false
#|result: "hide"


source(here("output1", "Regression.R"))
```

```{r}
cat("Summary Migration 2017")
summary(simple.lm.per1$DiffTotal2017)
"The numbers of NA is"
sum(is.na(simple.lm.per1$DiffTotal2017))

```

```{r}
#|label: Summary_Migration_2018
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Migration 2018")
summary(simple.lm.per2$DiffTotal2018)
"The numbers of NA is"
sum(is.na(simple.lm.per2$DiffTotal2018))

```

```{r}
#|label: Summary_Migration_2021
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Migration 2021")
summary(simple.lm.per3$DiffTotal2021)
"The numbers of NA is"
sum(is.na(simple.lm.per3$DiffTotal2021))

```

```{r}
#|label: Summary_Migration_2022
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Migration 2022")
summary(simple.lm.per4$DiffTotal2022)
"The numbers of NA is"
sum(is.na(simple.lm.per4$DiffTotal2022))

```

## Scatterplot of the Main Variables

```{r}
library(ggplot2)
plot2017<-ggplot(data=simple.lm.per1 )+
  geom_point(mapping =aes(x=Election2017,y=DiffTotal2017))+
  labs(title="Scatterplot of Voting Results and Migration 2017", x="Voting results", y="Percentage change in EU migrants")
print(plot2017)

plot2018<-ggplot(data=simple.lm.per2 )+
  geom_point(mapping =aes(x=Election2017,y=DiffTotal2018))+
  labs(title="Scatterplot of Voting Results and Migration 2018", x="Voting results", y="Percentage change in EU migrants")
print(plot2018)

plot2021<-ggplot(data=simple.lm.per3 )+
  geom_point(mapping =aes(x=Election2021,y=DiffTotal2021))+
  labs(title="Scatterplot of Voting Results and Migration 2021", x="Voting results", y="Percentage change in EU migrants")
print(plot2021)

plot2022<-ggplot(data=simple.lm.per4 )+
  geom_point(mapping =aes(x=Election2021,y=DiffTotal2022))+
  labs(title="Scatterplot of Voting Results and Migration 2022", x="Voting results", y="Percentage change in EU migrants")
print(plot2022)
```

## Control Variables

### CV1: Big Cities

We categorize our voting districts according to whether they are located within a major city. As "Big cities" we define the top 15 cities in Germany based on population. We chose this differentiation because there is a large gap in population between number 15, Duisburg, with 502.000 inhabitants and number 16, Bochum, with 365.000 inhabitants. The data is from DESTATIS. Due to the data being from an official source the quality of the data can be assumed to be good. The unit of measurement is a dummy variable with 1 if the voting district is part of one of the top 15 cities and 0 if not.

*Link: [https://www.destatis.de/DE/Themen/Laender-Regionen/Regionales/Gemeindeverzeichnis/Administrativ/05-staedte.xlsx?\\\_\\\_blob=publicationFile](https://www.destatis.de/DE/Themen/Laender-Regionen/Regionales/Gemeindeverzeichnis/Administrativ/05-staedte.xlsx?__blob=publicationFile){.uri}*

*Citation: DESTATIS. Städte in Deutschland. [https://www.destatis.de/DE/Themen/Laender-Regionen/Regionales/Gemeindeverzeichnis/Administrativ/05-staedte.xlsx?\\\_\\\_blob=publicationFile](https://www.destatis.de/DE/Themen/Laender-Regionen/Regionales/Gemeindeverzeichnis/Administrativ/05-staedte.xlsx?__blob=publicationFile){.uri}*

```{r}
#|label: Summary_Big_Cities
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Big Cities")
summary(Combined_Data$Big.City)
"The numbers of NA is"
sum(is.na(Combined_Data$Big.City))

```

### CV2: East Germany

Our second variable is a dummy variable that determines if a voting district is located in East Germany or not. We introduce this variable by using data from the Federal Returning Officer, which states which voting district number belongs to which state. We then assign the states "Sachsen", "Sachsen-Anhalt", "Thüringen", "Brandenburg" and "Mecklenburg-Vorpommern" to East Germany. The data is from an official source and thus can be assumed to be reliable. The unit of measurement is a dummy variable with 1 if the voting district is located in East Germany and 0 if not.

*Link: <https://www.bundeswahlleiterin.de/en/bundestagswahlen/2021/wahlkreiseinteilung.html>*

*Citation: the Federal Returning Officer, Delimitation of constituencies. <https://www.bundeswahlleiterin.de/en/bundestagswahlen/2021/wahlkreiseinteilung.html>*

```{r}
#|label: Summary_East_Germany
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary East Germany")
summary(Combined_Data$East.Germany)
"The numbers of NA is"
sum(is.na(Combined_Data$East.Germany))

```

### CV3: Healthcare

One of our control variables is the access to healthcare for each federal district. To quantify this, we use the number of hospital beds per 1000 inhabitants. The data is from the INKAR database, which is a database for indicators of spatial and urban development (BBSR) in Germany, published by the Federal Institute for research on Building, Urban Affairs and Spatial Development. The data is from an official source and can be assumed to be reliable. The data is only available till 2021, so we used data from the years 2017, 2018 and 2021 and used the 2021 data for both 2021 and 2022. The unit of measurement is the number of hospital beds per 1000 inhabitants. *Link:<https://www.inkar.de/WizardStart>*

To access the specific data, it is necessary to select "Medizinische und soziale Versorgung", "Medizinische Versorgung" and then "Krankenhausbetten". Afterwards it is necessary to select all federal districts and the years 2017, 2018 and 2021. Unfortunately there is no direct link to the dataset.

*Citation: BBSR, INKAR Database: Krankenhausbetten je 1000 Einwohner. <https://www.inkar.de/WizardStart>*

```{r}
#|label: Summary_Healthcare_2017
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Healthcare 2017")
summary(Combined_Data$KH2017)
"The numbers of NA is"
sum(is.na(Combined_Data$KH2017))

```

```{r}
#|label: Summary_Healthcare_2018
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Healthcare 2018")
summary(Combined_Data$KH2018)
"The numbers of NA is"
sum(is.na(Combined_Data$KH2018))

```

```{r}
#|label: Summary_Healthcare_2021
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Healthcare 2021")
summary(Combined_Data$KH2021)
"The numbers of NA is"
sum(is.na(Combined_Data$KH2021))

```

```{r}
#|label: Plot_Healthcare_2017
#|output: TRUE
#|code-line-numbers: FALSE

HC2017<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=KH2017),bins=20,fill="blue",color="black")+
  labs(title="Histogram of Healthcare 2017", x="Hospital Beds per 1000 Inhabitants", y="Number of Voting Districts")
print(HC2017)

HC2018<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=KH2018),bins=20,fill="blue",color="black")+
  labs(title="Histogram of Healthcare 2018", x="Hospital Beds per 1000 Inhabitants", y="Number of Voting Districts")
print(HC2018)

HC2019<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=KH2021),bins=20,fill="blue",color="black")+
  labs(title="Histogram of Healthcare 2021", x="Hospital Beds per 1000 Inhabitants", y="Number of Voting Districts")
print(HC2019)
```

### CV4: Purchase Power

Our next control variable is the purchasing power of households. Again, we use data from the INKAR database from the BBSR, which can be assumed to be reliable quality data due to it being from a federal institution. The data is only available till the year 2021, so again we use data from 2017 2018 and 2021 for the corresponding years, but use the 2021 also for the regression of the year 2022. The unit of measurement is the purchasing power per inhabitant in euros. That means its a combination of both the income as well as the living costs in the corresponding state.

*Link: <https://www.inkar.de/WizardStart>* To access the specific data, it is necessary to select "Privateinkommen, "Private Schulden" and then "Kaufkraft", select all the federal districts and the years 2017,2018 and 2021. Unfortunately there is no direct link to the dataset.

*Citattion:BBSR, IMKAR Database: Kaufkraft je Einwohner. <https://www.inkar.de/WizardStart>*

```{r}
#|label: Summary_PP_2017
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary PP 2017")
summary(Combined_Data$PurchasePower2017)
"The numbers of NA is"
sum(is.na(Combined_Data$PurchasePower2017))
```

```{r}
#|label: Summary_PP_2018
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary PP 2018")
summary(Combined_Data$PurchasePower2018)
"The numbers of NA is"
sum(is.na(Combined_Data$PurchasePower2018))
```

```{r}
#|label: Summary_PP_2021
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary PP 2021")
summary(Combined_Data$PurchasePower2021)
"The numbers of NA is"
sum(is.na(Combined_Data$PurchasePower2021))
```

```{r}
#|label: Plot_PP_2017
#|output: TRUE
#|code-line-numbers: FALSE

PP2017<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=PurchasePower2017),bins=20,fill="red",color="black")+
  labs(title="Histogram of Purchase Power 2017", x="Average Purchase Power of individuals", y="Number of Voting Districts")
print(PP2017)

PP2018<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=PurchasePower2018),bins=20,fill="red",color="black")+
  labs(title="Histogram of Purchase Power 2018", x="Average Purchase Power of individuals", y="Number of Voting Districts")
print(PP2018)

PP2021<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=PurchasePower2021),bins=20,fill="red",color="black")+
  labs(title="Histogram of Purchase Power 2021", x="Average Purchase Power of individuals", y="Number of Voting Districts")
print(PP2021)
```

### CV5: Unemployment

Our next control variable is the unemployment rate in each state. We use data from the INKAR database from the BBSR, which can be assumed to be reliable quality data due to it being from a federal institution. The data is only available till the year 2021, so we use data from 2017, 2018 and 2021 for the corresponding years, but use the 2021 also for the regression of the year 2022. The unit of measurement is the unemployment rate in percent.

*Link: <https://www.inkar.de/WizardStart>*

To access the data, it is necessary to select "Absolutzahlen" and then ""Arbeitslosenzahlen", select all the federal districts and the years 2017, 2018 and 2021. Unfortunately there is no direct link to the dataset.

*Citation: BBSR, INKAR Database: Arbeitslosenzahlen. <https://www.inkar.de/WizardStart>*

```{r}
#|label: Summary_Unemploment_2017
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Unemployment 2017")
summary(Combined_Data$Unemployment2017)
"The numbers of NA is"
sum(is.na(Combined_Data$Unemployment2017))
```

```{r}
#|label: Summary_Unemploment_2018
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Unemployment 2018")
summary(Combined_Data$Unemployment2018)
"The numbers of NA is"
sum(is.na(Combined_Data$Unemployment2018))
```

```{r}
#|label: Summary_Unemploment_2021
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Unemployment 2021")
summary(Combined_Data$Unemployment2021)
"The numbers of NA is"
sum(is.na(Combined_Data$Unemployment2021))
```

```{r}
#|label: Plot_Unemploment_2017
#|output: TRUE
#|code-line-numbers: FALSE
UE2017<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=Unemployment2017),bins=20,fill="green",color="black")+
  labs(title="Histogram of Unemployment 2017", x="Unemployment Rate", y="Number of Voting Districts")
print(UE2017)

UE2018<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=Unemployment2018),bins=20,fill="green",color="black")+
  labs(title="Histogram of Unemployment 2018", x="Unemployment Rate", y="Number of Voting Districts")
print(UE2018)

UE2021<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=Unemployment2021),bins=20,fill="green",color="black")+
  labs(title="Histogram of Unemployment 2021", x="Unemployment Rate", y="Number of Voting Districts")
print(UE2021)
```

### CV6: Total Population

Our final control variable is the total population of EU migrants before the election. This data is from the same dataset as the [Main outcome variable: Change of the number of EU migrants]. We use data from 2016 and 2020 as they are our baseline numbers. The data is from DESTATIS, the official German Statistical Office, and in particular from the GENESIS-Database. The data is from an official source and can be assumed to be reliable. The unit of measurement is the total number of EU migrants in each voting district.

*Link: <https://www-genesis.destatis.de/genesis//online?operation=table&code=12521-0040&bypass=true&levelindex=1&levelid=1719084022304#abreadcrumb>*

To access the data that was used, it is necessary to create a free account and select the years 2016 and 2020.

*Citation: DESTATIS. 12521-0040:Ausländer: Kreise, Stichtag, Geschlecht. <https://www-genesis.destatis.de/genesis//online?operation=table&code=12521-0040&bypass=true&levelindex=1&levelid=1719084022304#abreadcrumb>*

```{r}
#|label: Summary_TotalNumbers_2016
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Total Migrants 2016")
summary(Combined_Data$Total2016)
"The numbers of NA is"
sum(is.na(Combined_Data$Total2016))
```

```{r}
#|label: Summary_TotalNumbers_2020
#|output: TRUE
#|code-line-numbers: FALSE

cat("Summary Total Migrants 2020")
summary(Combined_Data$Total2020)
"The numbers of NA is"
sum(is.na(Combined_Data$Total2020))
```

```{r}
#|output: TRUE
#|code-line-numbers: FALSE
TotalM2016<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=Total2016),bins=20,fill="violet",color="black")+
  labs(title="Histogram of Total EU Migrants 2016", x="Total Migrants", y="Number of Voting Districts")
print(TotalM2016)

TotalM2020<-ggplot()+
  geom_histogram(data=Combined_Data,aes(x=Total2020),bins=20,fill="violet",color="black")+
  labs(title="Histogram of Total EU Migrants 2020", x="Total Migrants", y="Number of Voting Districts")
print(TotalM2020)
```

## Spatial Data

### Thought Process

The migration data is only accessible on federal level and the voting data only on voting district level. We decided to project the migration data on the voting district level by using spatial data. We determined how each federal district is divided into the different voting districts by area. The percentage of a federal district, that belongs to a voting district is used to weight the federal data. This way variables, that are only available on federal district level can be assigned to voting districts. For example, if 50% of a federal district belong to a voting district, 50% of the migrants in said district are assigned to the voting district. Because voting districts are usually a part of multiple federal district, this weighted data is added up. The final result is, that we define voting districts as a combination of different partial federal districts, weighted by the area.

By using this method we have to assume that population and migrants are distributed equally across the federal district area. This is a very strong assumption. The main reason why this assumption can be assumed to be accurate is the structure of the federal and voting data. Our initial assumption is mainly violated by large centers of population that concentrate a lot of population and migrants. Those centers of populations are usually their own federal district and not part of a larger federal district, which includes further rural areas. In those centers of populations the population can be seen as roughly equally distributed. A mixture of rural and urban areas, which would implement a strong bias into our regression, is not common. If such a mix occurs, the influence of the urban centers is not as grave, as they are small urban centers, while the larger ones are their own federal districts. To further strengthen this method, we manually assigned percentages to voting districts that are solely part of large population centers (and thus federal districts), such as Berlin. For example Berlin is a federal district that is divided into 12 voting districts, that differ by size but are nearly equal in population. Here we assigned each voting district 1/12 of the federal district population instead of dividing by size. This is possible due to the German law, which states that voting districts have to be roughly equal in size (https://www.bundeswahlleiterin.de/en/bundestagswahlen/2021/wahlkreiseinteilung.html).

### Programming Process

The following process was used to combine both datasets.

1.  Create maps with borders of voting districts and federal districts by using the st_read command from the "sf"-package, which is used to wrangle spatial data.

2.  Use the st_intersection command to combine both datasets. This command joins the voting district data with the federal district data by using the borders of both spatial datasets.

3.  Use the st_area command to calculate each voting district and federal district intersection.

4.  We now determine how much of each federal voting district belongs to a specific voting district (f.e. 50% of federal district 1 belong to voting district 1 and 50% to voting district 2). This is used to weight our data and assign the federal district data to the voting district data. Each voting district is now a combination of each federal district that belongs to it.

5.  We eliminated dependencies in the dataset that existed in the spatial data but not in reality. We determined by trial and error that 3% is a good threshold. That means, if less then 3% of a federal district belong to a certain voting district, the dependency is eliminated. We assume this faulty dependencies are due to the spatial data not being entirely accurate.

### Voting districts data

To access voting district spatial data, we used data provided by the Federal Returning Officer. The data is from an official source and can be assumed to be reliable. As voting districts differ in 2017 and 2021 we used spatial data from both years.

*Link (2017): <https://www.bundeswahlleiterin.de/dam/jcr/67e3e9b8-dbca-4bc9-8977-ac792665bbce/btw17_geometrie_wahlkreise_vg250_shp.zip>*

*Link (2021): <https://www.bundeswahlleiterin.de/dam/jcr/f0ce06a7-188c-4ef3-b49b-5a66719d2b46/btw21_geometrie_wahlkreise_vg250_shp.zip>*

*Citation (2017): the Federal Returning Officer, Map of constituencies for download. <https://www.bundeswahlleiterin.de/dam/jcr/67e3e9b8-dbca-4bc9-8977-ac792665bbce/btw17_geometrie_wahlkreise_vg250_shp.zip>*

*Citation (2021): the Federal Returning Officer, Map of constituencies for download. <https://www.bundeswahlleiterin.de/dam/jcr/f0ce06a7-188c-4ef3-b49b-5a66719d2b46/btw21_geometrie_wahlkreise_vg250_shp.zip>*

### Federal districts data

To access federal district spatial data, we used data provided by the Federal Agency for Cartography and Geodesy. The data is from an official source and can be assumed to be reliable. The data is from the 01.01.2023.

*Link: <https://daten.gdz.bkg.bund.de/produkte/vg/vg250_ebenen_0101/aktuell/vg250_01-01.utm32s.shape.ebenen.zip>*

This link provides data for different organisational units. To access the spatial federal district data, it is necessary to select the files with the name "VG250_KRS".

*Citation: Federal Agency for Cartography and Geodesy, Verwaltungsgebiete 1:250 000 Stand 01.01. (VG250 01.01.). <https://daten.gdz.bkg.bund.de/produkte/vg/vg250_ebenen_0101/aktuell/vg250_01-01.utm32s.shape.ebenen.zip>*
